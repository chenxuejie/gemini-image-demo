<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini 2.5 Flash Lite å›¾ç‰‡/è§†é¢‘æ¨ç†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .model-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 25px;
            padding: 15px 20px;
            background: linear-gradient(135deg, #f8f9ff 0%, #e8ebff 100%);
            border-radius: 12px;
            border: 1px solid #e0e5ff;
        }
        
        .model-selector label {
            font-size: 15px;
            font-weight: 600;
            color: #333;
        }
        
        .model-selector select {
            padding: 10px 20px;
            font-size: 15px;
            border: 2px solid #667eea;
            border-radius: 8px;
            background: white;
            color: #333;
            cursor: pointer;
            min-width: 220px;
            transition: all 0.3s ease;
        }
        
        .model-selector select:hover {
            border-color: #764ba2;
        }
        
        .model-selector select:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(118, 75, 162, 0.2);
        }
        
        /* æ¨¡å¼åˆ‡æ¢æ ‡ç­¾ */
        .mode-tabs {
            display: flex;
            margin-bottom: 25px;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #667eea;
        }
        
        .mode-tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            background: white;
            color: #667eea;
        }
        
        .mode-tab:hover {
            background: #f0f2ff;
        }
        
        .mode-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .mode-tab .icon {
            margin-right: 8px;
        }
        
        /* æ¨¡å¼å†…å®¹åŒºåŸŸ */
        .mode-content {
            display: none;
        }
        
        .mode-content.active {
            display: block;
        }
        
        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9ff;
            margin-bottom: 20px;
        }
        
        .upload-area:hover {
            border-color: #764ba2;
            background: #f0f2ff;
        }
        
        .upload-area.dragover {
            border-color: #764ba2;
            background: #e8ebff;
        }
        
        .upload-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .upload-text {
            color: #666;
            font-size: 16px;
        }
        
        .file-input {
            display: none;
        }
        
        .preview-container {
            display: none;
            margin-bottom: 20px;
        }
        
        .preview-container.show {
            display: block;
        }
        
        .preview-title {
            font-size: 16px;
            color: #333;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .image-preview, .video-preview {
            max-width: 100%;
            max-height: 400px;
            border-radius: 10px;
            display: block;
            margin: 0 auto;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }
        
        .file-info {
            text-align: center;
            margin-top: 10px;
            color: #666;
            font-size: 14px;
        }
        
        .settings-section {
            display: none;
            margin-bottom: 20px;
            padding: 20px;
            background: #f8f9ff;
            border-radius: 10px;
            border: 1px solid #e0e5ff;
        }
        
        .settings-section.show {
            display: block;
        }
        
        .settings-section h4 {
            margin-bottom: 15px;
            color: #333;
            font-size: 16px;
        }
        
        .settings-row {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .settings-row:last-child {
            margin-bottom: 0;
        }
        
        .input-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .input-group label {
            color: #666;
            font-size: 14px;
            min-width: 80px;
        }
        
        .input-group input, .input-group select {
            width: 120px;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            text-align: center;
        }
        
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .input-group span {
            color: #888;
            font-size: 13px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .checkbox-group label {
            color: #666;
            font-size: 14px;
            cursor: pointer;
        }
        
        .settings-info {
            margin-top: 10px;
            font-size: 12px;
            color: #888;
        }
        
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
        }
        
        .radio-label {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .radio-label:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }
        
        .radio-label input[type="radio"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .radio-label input[type="radio"]:checked + .radio-text {
            color: #667eea;
            font-weight: 600;
        }
        
        .radio-label:has(input[type="radio"]:checked) {
            border-color: #667eea;
            background: #f0f2ff;
        }
        
        .radio-text {
            font-size: 15px;
            color: #333;
        }
        
        .radio-desc {
            font-size: 12px;
            color: #888;
            width: 100%;
            margin-left: 30px;
        }
        
        .frames-settings {
            margin-top: 15px;
            padding: 15px;
            background: #fff;
            border-radius: 8px;
            border: 1px solid #e0e5ff;
        }
        
        .preview-btn {
            margin-top: 15px;
            padding: 10px 20px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .preview-btn:hover {
            background: #218838;
        }
        
        .preview-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .resized-preview-container {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background: #e8f5e9;
            border-radius: 10px;
            border: 1px solid #c8e6c9;
        }
        
        .resized-preview-container.show {
            display: block;
        }
        
        .resized-preview-container h5 {
            margin-bottom: 10px;
            color: #2e7d32;
            font-size: 14px;
        }
        
        .resized-preview-container img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            display: block;
            margin: 0 auto;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
        }
        
        .resized-info {
            text-align: center;
            margin-top: 10px;
            color: #2e7d32;
            font-size: 13px;
        }
        
        .prompt-section {
            margin-bottom: 20px;
        }
        
        .prompt-section label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }
        
        .prompt-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            resize: vertical;
            min-height: 80px;
            transition: border-color 0.3s;
        }
        
        .prompt-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .submit-btn {
            width: 100%;
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        
        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .loading.show {
            display: block;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .result-section {
            display: none;
            margin-top: 30px;
            padding: 25px;
            background: #f8f9ff;
            border-radius: 15px;
            border: 1px solid #e0e5ff;
        }
        
        .result-section.show {
            display: block;
        }
        
        .result-title {
            font-size: 20px;
            color: #333;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .token-info {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .token-box {
            flex: 1;
            min-width: 150px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .token-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .token-value {
            font-size: 28px;
            font-weight: 700;
            color: #667eea;
        }
        
        /* è¯¦ç»† Token ä¿¡æ¯æ ·å¼ */
        .token-details-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .token-details-section h5 {
            margin-bottom: 15px;
            color: #333;
            font-size: 16px;
        }
        
        .token-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .token-detail-card {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e0e5ff;
        }
        
        .token-detail-card h6 {
            font-size: 13px;
            color: #667eea;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .token-detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px solid #e8ebff;
        }
        
        .token-detail-item:last-child {
            border-bottom: none;
        }
        
        .token-detail-label {
            font-size: 12px;
            color: #666;
        }
        
        .token-detail-value {
            font-size: 14px;
            font-weight: 600;
            color: #333;
        }
        
        .token-detail-value.highlight {
            color: #667eea;
        }
        
        .token-detail-value.thinking {
            color: #ff9800;
        }
        
        .token-detail-value.tool {
            color: #4caf50;
        }
        
        .info-box {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .info-box h5 {
            margin-bottom: 10px;
            color: #333;
        }
        
        .info-box p {
            font-size: 14px;
            color: #666;
            margin: 5px 0;
        }
        
        .frames-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .frames-preview img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .processed-media-section {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .processed-media-section h5 {
            margin-bottom: 10px;
            color: #333;
        }
        
        .processed-media-section img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            display: block;
            margin: 0 auto;
        }
        
        .response-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 15px;
            line-height: 1.6;
            color: #333;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .error-message {
            background: #fff0f0;
            border: 1px solid #ffcccc;
            color: #cc0000;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }
        
        .error-message.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ–¼ï¸ Gemini å›¾ç‰‡/è§†é¢‘æ¨ç†</h1>
        <p class="subtitle">ä¸Šä¼ å›¾ç‰‡æˆ–è§†é¢‘ï¼Œä½¿ç”¨ Gemini AI è¿›è¡Œåˆ†æ</p>
        
        <!-- æ¨¡å‹é€‰æ‹© -->
        <div class="model-selector">
            <label for="modelSelect">ğŸ¤– é€‰æ‹©æ¨¡å‹:</label>
            <select id="modelSelect">
                <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash Lite</option>
                <option value="gemini-2.0-flash-lite-001">Gemini 2.0 Flash Lite</option>
                <option value="gemini-3-pro-preview">Gemini 3 Pro Preview</option>
                <option value="gemini-3-flash-preview">Gemini 3 Flash Preview</option>
            </select>
        </div>
        
        <!-- åª’ä½“åˆ†è¾¨ç‡è®¾ç½®ï¼ˆå›¾ç‰‡å’Œè§†é¢‘æ¨¡å¼éƒ½æ˜¾ç¤ºï¼‰ -->
        <div class="settings-section show" id="mediaResolutionSettings">
            <h4>ğŸ“Š åª’ä½“åˆ†è¾¨ç‡è®¾ç½®</h4>
            
            <!-- Media Resolution -->
            <div class="settings-row">
                <div class="input-group">
                    <label for="mediaResolutionSelect">åˆ†è¾¨ç‡:</label>
                    <select id="mediaResolutionSelect" style="width: 200px;">
                        <option value="unspecified">é»˜è®¤ (è‡ªåŠ¨)</option>
                        <option value="low">Low (ä½åˆ†è¾¨ç‡ï¼Œçœ tokens)</option>
                        <option value="medium">Medium (ä¸­ç­‰åˆ†è¾¨ç‡)</option>
                        <option value="high">High (é«˜åˆ†è¾¨ç‡)</option>
                    </select>
                </div>
            </div>
            
            <p class="settings-info" id="mediaResolutionInfo">
                ğŸ’¡ <strong>åˆ†è¾¨ç‡è®¾ç½®</strong>: å½±å“å›¾ç‰‡/è§†é¢‘çš„å¤„ç†ç²¾åº¦å’Œ token æ¶ˆè€—ã€‚<br>
                ğŸ“Š è§†é¢‘: Low ~100 tokens/ç§’ï¼Œé»˜è®¤ ~300 tokens/ç§’ã€‚<br>
                ğŸ–¼ï¸ å›¾ç‰‡: ä½åˆ†è¾¨ç‡å¯å‡å°‘ token æ¶ˆè€—ï¼Œé«˜åˆ†è¾¨ç‡å¯è·å¾—æ›´å¤šç»†èŠ‚ã€‚
            </p>
        </div>
        
        <!-- è§†é¢‘é«˜çº§è®¾ç½®ï¼ˆä»…è§†é¢‘æ¨¡å¼ä¸‹æ˜¾ç¤ºï¼‰ -->
        <div class="settings-section" id="videoAdvancedSettings" style="display: none;">
            <h4>ğŸ¬ è§†é¢‘å¤„ç†é«˜çº§è®¾ç½®</h4>
            
            <!-- Video FPS (ä»…è§†é¢‘æ¨¡å¼) -->
            <div class="settings-row">
                <div class="input-group">
                    <label for="videoFpsInput">é‡‡æ ·å¸§ç‡:</label>
                    <input type="number" id="videoFpsInput" value="1" min="0.1" max="24" step="0.1" style="width: 80px;">
                    <span>fps (0.1-24)</span>
                </div>
            </div>
            
            <!-- Video Clip (Start/End Offset) -->
            <div class="settings-row">
                <div class="input-group">
                    <label for="startOffsetInput">èµ·å§‹æ—¶é—´:</label>
                    <input type="text" id="startOffsetInput" placeholder="0s" style="width: 100px;">
                    <span>ç§’</span>
                </div>
                <div class="input-group">
                    <label for="endOffsetInput">ç»“æŸæ—¶é—´:</label>
                    <input type="text" id="endOffsetInput" placeholder="ç•™ç©º=å…¨éƒ¨" style="width: 100px;">
                    <span>ç§’</span>
                </div>
            </div>
            
            <p class="settings-info">
                ğŸ’¡ <strong>é‡‡æ ·å¸§ç‡</strong>: é»˜è®¤ 1 fpsï¼Œæœ€é«˜ 24 fpsã€‚æ›´é«˜å¸§ç‡æ•æ‰æ›´å¤šç»†èŠ‚ä½†æ¶ˆè€—æ›´å¤š tokensã€‚<br>
                â±ï¸ <strong>æ—¶é—´è£å‰ª</strong>: å¯æŒ‡å®šåˆ†æè§†é¢‘çš„èµ·å§‹å’Œç»“æŸæ—¶é—´ï¼ˆç§’ï¼‰ï¼Œç•™ç©ºåˆ™åˆ†ææ•´ä¸ªè§†é¢‘ã€‚
            </p>
        </div>
        
        <!-- æ¨¡å¼åˆ‡æ¢æ ‡ç­¾ -->
        <div class="mode-tabs">
            <div class="mode-tab active" data-mode="image">
                <span class="icon">ğŸ–¼ï¸</span>å›¾ç‰‡åˆ†æ
            </div>
            <div class="mode-tab" data-mode="video">
                <span class="icon">ğŸ¬</span>è§†é¢‘åˆ†æ
            </div>
        </div>
        
        <!-- å›¾ç‰‡æ¨¡å¼ -->
        <div class="mode-content active" id="imageMode">
            <div class="upload-area" id="imageUploadArea">
                <div class="upload-icon">ğŸ“</div>
                <p class="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„ä¸Šä¼ </p>
                <p class="upload-text" style="font-size: 12px; color: #999; margin-top: 10px;">æ”¯æŒ JPG, PNG, GIF, WebP æ ¼å¼</p>
            </div>
            <input type="file" class="file-input" id="imageFileInput" accept="image/*">
            
            <div class="preview-container" id="imagePreviewContainer">
                <p class="preview-title">ğŸ“· åŸå§‹å›¾ç‰‡é¢„è§ˆ</p>
                <img class="image-preview" id="imagePreview" src="" alt="é¢„è§ˆå›¾ç‰‡">
                <p class="file-info" id="imageInfo"></p>
            </div>
            
            <div class="settings-section" id="imageSettings">
                <h4>ğŸ“ è°ƒæ•´å›¾ç‰‡å°ºå¯¸</h4>
                <div class="settings-row">
                    <div class="input-group">
                        <label for="widthInput">å®½åº¦:</label>
                        <input type="number" id="widthInput" placeholder="å®½åº¦" min="1" max="4096">
                        <span>px</span>
                    </div>
                    <div class="input-group">
                        <label for="heightInput">é«˜åº¦:</label>
                        <input type="number" id="heightInput" placeholder="é«˜åº¦" min="1" max="4096">
                        <span>px</span>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="keepRatio" checked>
                        <label for="keepRatio">ä¿æŒå®½é«˜æ¯”</label>
                    </div>
                </div>
                <p class="settings-info" id="resizeInfo">ç•™ç©ºåˆ™ä½¿ç”¨åŸå§‹å°ºå¯¸</p>
                <button class="preview-btn" id="previewResizeBtn">ğŸ‘ï¸ é¢„è§ˆè°ƒæ•´åçš„å›¾ç‰‡</button>
                
                <div class="resized-preview-container" id="resizedPreviewContainer">
                    <h5>âœ… è°ƒæ•´åçš„å›¾ç‰‡é¢„è§ˆ</h5>
                    <img id="resizedImagePreview" src="" alt="è°ƒæ•´åçš„å›¾ç‰‡">
                    <p class="resized-info" id="resizedInfo"></p>
                </div>
            </div>
        </div>
        
        <!-- è§†é¢‘æ¨¡å¼ -->
        <div class="mode-content" id="videoMode">
            <div class="upload-area" id="videoUploadArea">
                <div class="upload-icon">ğŸ¬</div>
                <p class="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½è§†é¢‘åˆ°æ­¤å¤„ä¸Šä¼ </p>
                <p class="upload-text" style="font-size: 12px; color: #999; margin-top: 10px;">æ”¯æŒ MP4, WebM, MOV, TS æ ¼å¼ï¼Œæœ€å¤§ 100MB</p>
            </div>
            <input type="file" class="file-input" id="videoFileInput" accept="video/*,.ts,.TS">
            
            <div class="preview-container" id="videoPreviewContainer">
                <p class="preview-title">ğŸ¬ è§†é¢‘é¢„è§ˆ</p>
                <video class="video-preview" id="videoPreview" controls></video>
                <p class="file-info" id="videoInfo"></p>
            </div>
            
            <div class="settings-section" id="videoSettings">
                <h4>âš™ï¸ è§†é¢‘å¤„ç†è®¾ç½®</h4>
                
                <!-- å¤„ç†æ¨¡å¼é€‰æ‹© -->
                <div class="settings-row">
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="videoMode" value="direct" id="modeDirectRadio" checked>
                            <span class="radio-text">ğŸ¬ ç›´æ¥å‘é€è§†é¢‘</span>
                            <span class="radio-desc">å°†å®Œæ•´è§†é¢‘ç›´æ¥å‘é€ç»™ Geminiï¼ˆæ¨èï¼‰</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="videoMode" value="frames" id="modeFramesRadio">
                            <span class="radio-text">ğŸ–¼ï¸ æå–å¸§æ¨¡å¼</span>
                            <span class="radio-desc">ä»è§†é¢‘ä¸­æå–å¸§å›¾ç‰‡åå‘é€</span>
                        </label>
                    </div>
                </div>
                
                <!-- å¸§æå–è®¾ç½®ï¼ˆä»…åœ¨æå–å¸§æ¨¡å¼ä¸‹æ˜¾ç¤ºï¼‰ -->
                <div class="frames-settings" id="framesSettings" style="display: none;">
                    <div class="settings-row">
                        <div class="input-group">
                            <label for="fpsInput">æå–å¸§ç‡:</label>
                            <input type="number" id="fpsInput" value="1" min="0.1" max="30" step="0.1">
                            <span>fps</span>
                        </div>
                        <div class="input-group">
                            <label for="maxFramesInput">æœ€å¤§å¸§æ•°:</label>
                            <input type="number" id="maxFramesInput" value="30" min="1" max="60">
                            <span>å¸§</span>
                        </div>
                    </div>
                    
                    <!-- å¸§å°ºå¯¸è°ƒæ•´ -->
                    <div class="settings-row" style="margin-top: 15px;">
                        <div class="input-group">
                            <label for="frameWidthInput">å¸§å®½åº¦:</label>
                            <input type="number" id="frameWidthInput" placeholder="è‡ªåŠ¨" min="1" max="4096">
                            <span>px</span>
                        </div>
                        <div class="input-group">
                            <label for="frameHeightInput">å¸§é«˜åº¦:</label>
                            <input type="number" id="frameHeightInput" placeholder="è‡ªåŠ¨" min="1" max="4096">
                            <span>px</span>
                        </div>
                    </div>
                    
                    <p class="settings-info">
                        ğŸ’¡ æç¤ºï¼šFPS=1 è¡¨ç¤ºæ¯ç§’æå–1å¸§ï¼ŒFPS=0.5 è¡¨ç¤ºæ¯2ç§’æå–1å¸§ã€‚<br>
                        å¸§å°ºå¯¸ç•™ç©ºåˆ™ä½¿ç”¨åŸå§‹å°ºå¯¸ï¼Œåªå¡«ä¸€ä¸ªåˆ™æŒ‰æ¯”ä¾‹ç¼©æ”¾ã€‚è¾ƒå°çš„å¸§å°ºå¯¸å¯å‡å°‘Tokenæ¶ˆè€—ã€‚
                    </p>
                </div>
                
                <p class="settings-info" id="directModeInfo">
                    ğŸ’¡ ç›´æ¥å‘é€æ¨¡å¼ï¼šè§†é¢‘å°†å®Œæ•´å‘é€ç»™ Geminiï¼Œæ”¯æŒæ›´å¥½çš„æ—¶åºç†è§£ã€‚<br>
                    ğŸ“Š Token è®¡ç®—ï¼šé»˜è®¤åˆ†è¾¨ç‡ ~300 tokens/ç§’ï¼Œä½åˆ†è¾¨ç‡ ~100 tokens/ç§’<br>
                    â±ï¸ 2M ä¸Šä¸‹æ–‡çª—å£å¯å¤„ç†ï¼šé»˜è®¤ 2å°æ—¶ / ä½åˆ†è¾¨ç‡ 6å°æ—¶
                </p>
            </div>
        </div>
        
        <div class="prompt-section">
            <label for="promptInput">æç¤ºè¯ (Prompt)</label>
            <textarea class="prompt-input" id="promptInput" placeholder="è¯·æè¿°æ‚¨æƒ³è®© AI åˆ†æçš„å†…å®¹">è¯·æè¿°è¿™ä¸ªå†…å®¹</textarea>
        </div>
        
        <button class="submit-btn" id="submitBtn" disabled>æäº¤åˆ†æ</button>
        <button class="submit-btn" id="submitLangchainBtn" disabled style="margin-top: 10px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">ğŸ”— ä½¿ç”¨ LangChain åˆ†æ (media_resolution=medium)</button>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p id="loadingText">æ­£åœ¨åˆ†æä¸­ï¼Œè¯·ç¨å€™...</p>
        </div>
        
        <div class="error-message" id="errorMessage"></div>
        
        <div class="result-section" id="resultSection">
            <h3 class="result-title">ğŸ“Š åˆ†æç»“æœ</h3>
            <div class="token-info">
                <div class="token-box">
                    <div class="token-label">Input Tokens</div>
                    <div class="token-value" id="inputTokens">-</div>
                </div>
                <div class="token-box">
                    <div class="token-label">Output Tokens</div>
                    <div class="token-value" id="outputTokens">-</div>
                </div>
                <div class="token-box">
                    <div class="token-label">Total Tokens</div>
                    <div class="token-value" id="totalTokens">-</div>
                </div>
            </div>
            
            <!-- è¯¦ç»† Token ä¿¡æ¯ -->
            <div class="token-details-section" id="tokenDetailsSection" style="display: none;">
                <h5>ğŸ“Š Token è¯¦ç»†ä¿¡æ¯</h5>
                <div class="token-details-grid">
                    <!-- Input Token è¯¦æƒ… -->
                    <div class="token-detail-card">
                        <h6>ğŸ“¥ Input Tokens è¯¦æƒ…</h6>
                        <div class="token-detail-item">
                            <span class="token-detail-label">ğŸ“ Text</span>
                            <span class="token-detail-value" id="inputTextTokens">0</span>
                        </div>
                        <div class="token-detail-item">
                            <span class="token-detail-label">ğŸ–¼ï¸ Image</span>
                            <span class="token-detail-value highlight" id="inputImageTokens">0</span>
                        </div>
                        <div class="token-detail-item">
                            <span class="token-detail-label">ğŸ¬ Video</span>
                            <span class="token-detail-value highlight" id="inputVideoTokens">0</span>
                        </div>
                        <div class="token-detail-item">
                            <span class="token-detail-label">ğŸ”Š Audio</span>
                            <span class="token-detail-value" id="inputAudioTokens">0</span>
                        </div>
                        <div class="token-detail-item">
                            <span class="token-detail-label">ğŸ’¾ Cached</span>
                            <span class="token-detail-value" id="inputCachedTokens">0</span>
                        </div>
                    </div>
                    
                    <!-- Output Token è¯¦æƒ… -->
                    <div class="token-detail-card">
                        <h6>ğŸ“¤ Output Tokens è¯¦æƒ…</h6>
                        <div class="token-detail-item">
                            <span class="token-detail-label">ğŸ“ Text</span>
                            <span class="token-detail-value" id="outputTextTokens">0</span>
                        </div>
                        <div class="token-detail-item">
                            <span class="token-detail-label">ğŸ–¼ï¸ Image</span>
                            <span class="token-detail-value" id="outputImageTokens">0</span>
                        </div>
                        <div class="token-detail-item">
                            <span class="token-detail-label">ğŸ¬ Video</span>
                            <span class="token-detail-value" id="outputVideoTokens">0</span>
                        </div>
                        <div class="token-detail-item">
                            <span class="token-detail-label">ğŸ”Š Audio</span>
                            <span class="token-detail-value" id="outputAudioTokens">0</span>
                        </div>
                    </div>
                    
                    <!-- ç‰¹æ®Š Token è¯¦æƒ… -->
                    <div class="token-detail-card">
                        <h6>âš¡ ç‰¹æ®Š Tokens</h6>
                        <div class="token-detail-item">
                            <span class="token-detail-label">ğŸ§  Thinking</span>
                            <span class="token-detail-value thinking" id="thinkingTokens">0</span>
                        </div>
                        <div class="token-detail-item">
                            <span class="token-detail-label">ğŸ”§ Tool Use</span>
                            <span class="token-detail-value tool" id="toolUseTokens">0</span>
                        </div>
                        <div class="token-detail-item">
                            <span class="token-detail-label">ğŸ’¾ Cached Content</span>
                            <span class="token-detail-value" id="cachedContentTokens">0</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- å›¾ç‰‡ç»“æœä¿¡æ¯ -->
            <div class="info-box" id="imageSizeInfo" style="display: none;">
                <h5>ğŸ“ å›¾ç‰‡å°ºå¯¸ä¿¡æ¯</h5>
                <p id="originalSizeText">åŸå§‹å°ºå¯¸: -</p>
                <p id="processedSizeText">å¤„ç†åå°ºå¯¸: -</p>
                <p id="resizedText">æ˜¯å¦è°ƒæ•´: -</p>
            </div>
            
            <!-- è§†é¢‘ç»“æœä¿¡æ¯ -->
            <div class="info-box" id="videoResultInfo" style="display: none;">
                <h5>ğŸ¬ è§†é¢‘ä¿¡æ¯</h5>
                <p id="videoDimensionsText">è§†é¢‘å°ºå¯¸: -</p>
                <p id="videoDurationText">è§†é¢‘æ—¶é•¿: -</p>
                <p id="videoOriginalFpsText">åŸå§‹å¸§ç‡: -</p>
                <p id="videoExtractFpsText">æå–å¸§ç‡: -</p>
                <p id="framesExtractedText">æå–å¸§æ•°: -</p>
            </div>
            
            <!-- å¤„ç†åçš„å›¾ç‰‡ -->
            <div class="processed-media-section" id="processedImageSection" style="display: none;">
                <h5>ğŸ–¼ï¸ å‘é€ç»™ Gemini çš„å›¾ç‰‡</h5>
                <img id="processedImageResult" src="" alt="å¤„ç†åçš„å›¾ç‰‡">
            </div>
            
            <!-- è§†é¢‘å¸§é¢„è§ˆ -->
            <div class="processed-media-section" id="framesPreviewSection" style="display: none;">
                <h5>ğŸï¸ æå–çš„è§†é¢‘å¸§é¢„è§ˆï¼ˆå‰6å¸§ï¼‰</h5>
                <div class="frames-preview" id="framesPreview"></div>
            </div>
            
            <h4 style="margin-bottom: 10px; color: #333;">AI å“åº”å†…å®¹ï¼š</h4>
            <div class="response-content" id="responseContent"></div>
        </div>
    </div>
    
    <script>
        // æ¨¡å¼åˆ‡æ¢
        const modeTabs = document.querySelectorAll('.mode-tab');
        const modeContents = document.querySelectorAll('.mode-content');
        let currentMode = 'image';
        
        modeTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const mode = tab.dataset.mode;
                currentMode = mode;
                
                modeTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                modeContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === mode + 'Mode') {
                        content.classList.add('active');
                    }
                });
                
                // æ›´æ–°æç¤ºè¯
                if (mode === 'image') {
                    document.getElementById('promptInput').placeholder = 'è¯·æè¿°æ‚¨æƒ³è®© AI åˆ†æçš„å†…å®¹ï¼Œä¾‹å¦‚ï¼šè¯·æè¿°è¿™å¼ å›¾ç‰‡çš„å†…å®¹';
                } else {
                    document.getElementById('promptInput').placeholder = 'è¯·æè¿°æ‚¨æƒ³è®© AI åˆ†æçš„å†…å®¹ï¼Œä¾‹å¦‚ï¼šè¯·æè¿°è¿™ä¸ªè§†é¢‘çš„å†…å®¹';
                }
                
                // é‡ç½®æäº¤æŒ‰é’®çŠ¶æ€
                updateSubmitButton();
                
                // æ›´æ–° Media Resolution æ˜¾ç¤º
                updateMediaResolutionVisibility();
            });
        });
        
        // å›¾ç‰‡ç›¸å…³å˜é‡
        const imageUploadArea = document.getElementById('imageUploadArea');
        const imageFileInput = document.getElementById('imageFileInput');
        const imagePreviewContainer = document.getElementById('imagePreviewContainer');
        const imagePreview = document.getElementById('imagePreview');
        const imageInfo = document.getElementById('imageInfo');
        const imageSettings = document.getElementById('imageSettings');
        const widthInput = document.getElementById('widthInput');
        const heightInput = document.getElementById('heightInput');
        const keepRatio = document.getElementById('keepRatio');
        const resizeInfo = document.getElementById('resizeInfo');
        const previewResizeBtn = document.getElementById('previewResizeBtn');
        const resizedPreviewContainer = document.getElementById('resizedPreviewContainer');
        const resizedImagePreview = document.getElementById('resizedImagePreview');
        const resizedInfoText = document.getElementById('resizedInfo');
        
        let selectedImageFile = null;
        let originalWidth = 0;
        let originalHeight = 0;
        let aspectRatio = 1;
        let originalImageData = null;
        
        // è§†é¢‘ç›¸å…³å˜é‡
        const videoUploadArea = document.getElementById('videoUploadArea');
        const videoFileInput = document.getElementById('videoFileInput');
        const videoPreviewContainer = document.getElementById('videoPreviewContainer');
        const videoPreview = document.getElementById('videoPreview');
        const videoInfo = document.getElementById('videoInfo');
        const videoSettings = document.getElementById('videoSettings');
        const fpsInput = document.getElementById('fpsInput');
        const maxFramesInput = document.getElementById('maxFramesInput');
        const modeDirectRadio = document.getElementById('modeDirectRadio');
        const modeFramesRadio = document.getElementById('modeFramesRadio');
        const framesSettings = document.getElementById('framesSettings');
        const directModeInfo = document.getElementById('directModeInfo');
        const frameWidthInput = document.getElementById('frameWidthInput');
        const frameHeightInput = document.getElementById('frameHeightInput');
        
        let selectedVideoFile = null;
        
        // è§†é¢‘æ¨¡å¼åˆ‡æ¢
        modeDirectRadio.addEventListener('change', () => {
            if (modeDirectRadio.checked) {
                framesSettings.style.display = 'none';
                directModeInfo.style.display = 'block';
            }
        });
        
        modeFramesRadio.addEventListener('change', () => {
            if (modeFramesRadio.checked) {
                framesSettings.style.display = 'block';
                directModeInfo.style.display = 'none';
            }
        });
        
        // é€šç”¨å˜é‡
        const submitBtn = document.getElementById('submitBtn');
        const loading = document.getElementById('loading');
        const loadingText = document.getElementById('loadingText');
        const resultSection = document.getElementById('resultSection');
        const errorMessage = document.getElementById('errorMessage');
        const modelSelect = document.getElementById('modelSelect');
        const mediaResolutionSelector = document.getElementById('mediaResolutionSelector');
        const mediaResolutionSelect = document.getElementById('mediaResolutionSelect');
        
        // è§†é¢‘é«˜çº§è®¾ç½®å…ƒç´ 
        const videoAdvancedSettings = document.getElementById('videoAdvancedSettings');
        const videoFpsInput = document.getElementById('videoFpsInput');
        const startOffsetInput = document.getElementById('startOffsetInput');
        const endOffsetInput = document.getElementById('endOffsetInput');
        
        // æ›´æ–°è§†é¢‘é«˜çº§è®¾ç½®æ˜¾ç¤ºçŠ¶æ€
        function updateMediaResolutionVisibility() {
            // è§†é¢‘æ¨¡å¼ä¸‹æ˜¾ç¤ºé«˜çº§è®¾ç½®
            if (currentMode === 'video') {
                videoAdvancedSettings.style.display = 'block';
                videoAdvancedSettings.classList.add('show');
            } else {
                videoAdvancedSettings.style.display = 'none';
                videoAdvancedSettings.classList.remove('show');
            }
        }
        
        // æ¨¡å‹é€‰æ‹©å˜åŒ–æ—¶
        modelSelect.addEventListener('change', () => {
            updateMediaResolutionVisibility();
        });
        
        // å›¾ç‰‡ä¸Šä¼ äº‹ä»¶
        imageUploadArea.addEventListener('click', () => imageFileInput.click());
        
        imageUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            imageUploadArea.classList.add('dragover');
        });
        
        imageUploadArea.addEventListener('dragleave', () => {
            imageUploadArea.classList.remove('dragover');
        });
        
        imageUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            imageUploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleImageFile(files[0]);
            }
        });
        
        imageFileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleImageFile(e.target.files[0]);
            }
        });
        
        // è§†é¢‘ä¸Šä¼ äº‹ä»¶
        videoUploadArea.addEventListener('click', () => videoFileInput.click());
        
        videoUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            videoUploadArea.classList.add('dragover');
        });
        
        videoUploadArea.addEventListener('dragleave', () => {
            videoUploadArea.classList.remove('dragover');
        });
        
        videoUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            videoUploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleVideoFile(files[0]);
            }
        });
        
        videoFileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleVideoFile(e.target.files[0]);
            }
        });
        
        function handleImageFile(file) {
            if (!file.type.startsWith('image/')) {
                showError('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶');
                return;
            }
            
            selectedImageFile = file;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                originalImageData = e.target.result;
                imagePreview.src = originalImageData;
                imagePreviewContainer.classList.add('show');
                imageSettings.classList.add('show');
                resizedPreviewContainer.classList.remove('show');
                
                const img = new Image();
                img.onload = () => {
                    originalWidth = img.width;
                    originalHeight = img.height;
                    aspectRatio = originalWidth / originalHeight;
                    
                    imageInfo.textContent = `æ–‡ä»¶å: ${file.name} | å°ºå¯¸: ${img.width} x ${img.height} | å¤§å°: ${formatFileSize(file.size)}`;
                    
                    widthInput.value = originalWidth;
                    heightInput.value = originalHeight;
                    widthInput.placeholder = originalWidth;
                    heightInput.placeholder = originalHeight;
                    
                    updateResizeInfo();
                };
                img.src = originalImageData;
            };
            reader.readAsDataURL(file);
            
            updateSubmitButton();
            hideError();
        }
        
        function handleVideoFile(file) {
            // Check if it's a video file by MIME type or file extension
            const fileName = file.name.toLowerCase();
            const isVideoByType = file.type.startsWith('video/');
            const isVideoByExtension = fileName.endsWith('.mp4') || fileName.endsWith('.webm') || 
                                        fileName.endsWith('.mov') || fileName.endsWith('.avi') || 
                                        fileName.endsWith('.ts') || fileName.endsWith('.mkv') ||
                                        fileName.endsWith('.m2ts') || fileName.endsWith('.mts');
            
            if (!isVideoByType && !isVideoByExtension) {
                showError('è¯·é€‰æ‹©è§†é¢‘æ–‡ä»¶ï¼ˆæ”¯æŒ MP4, WebM, MOV, TS æ ¼å¼ï¼‰');
                return;
            }
            
            const fileSizeMB = file.size / (1024 * 1024);
            if (fileSizeMB > 100) {
                showError('è§†é¢‘æ–‡ä»¶è¿‡å¤§ï¼Œè¯·ä¸Šä¼ å°äº 100MB çš„è§†é¢‘');
                return;
            }
            
            selectedVideoFile = file;
            
            const url = URL.createObjectURL(file);
            videoPreview.src = url;
            videoPreviewContainer.classList.add('show');
            videoSettings.classList.add('show');
            
            videoPreview.onloadedmetadata = () => {
                const duration = videoPreview.duration;
                const width = videoPreview.videoWidth;
                const height = videoPreview.videoHeight;
                
                videoInfo.textContent = `æ–‡ä»¶å: ${file.name} | å°ºå¯¸: ${width} x ${height} | æ—¶é•¿: ${duration.toFixed(2)}ç§’ | å¤§å°: ${formatFileSize(file.size)}`;
            };
            
            updateSubmitButton();
            hideError();
        }
        
        function updateSubmitButton() {
            if (currentMode === 'image') {
                submitBtn.disabled = !selectedImageFile;
            } else {
                submitBtn.disabled = !selectedVideoFile;
            }
        }
        
        // å®½åº¦è¾“å…¥å˜åŒ–æ—¶
        widthInput.addEventListener('input', () => {
            if (keepRatio.checked && widthInput.value) {
                const newWidth = parseInt(widthInput.value);
                if (!isNaN(newWidth) && newWidth > 0) {
                    heightInput.value = Math.round(newWidth / aspectRatio);
                }
            }
            updateResizeInfo();
            resizedPreviewContainer.classList.remove('show');
        });
        
        // é«˜åº¦è¾“å…¥å˜åŒ–æ—¶
        heightInput.addEventListener('input', () => {
            if (keepRatio.checked && heightInput.value) {
                const newHeight = parseInt(heightInput.value);
                if (!isNaN(newHeight) && newHeight > 0) {
                    widthInput.value = Math.round(newHeight * aspectRatio);
                }
            }
            updateResizeInfo();
            resizedPreviewContainer.classList.remove('show');
        });
        
        // ä¿æŒå®½é«˜æ¯”å¤é€‰æ¡†å˜åŒ–
        keepRatio.addEventListener('change', () => {
            if (keepRatio.checked && widthInput.value) {
                const newWidth = parseInt(widthInput.value);
                if (!isNaN(newWidth) && newWidth > 0) {
                    heightInput.value = Math.round(newWidth / aspectRatio);
                }
            }
            updateResizeInfo();
        });
        
        function updateResizeInfo() {
            const targetWidth = parseInt(widthInput.value) || originalWidth;
            const targetHeight = parseInt(heightInput.value) || originalHeight;
            
            if (targetWidth === originalWidth && targetHeight === originalHeight) {
                resizeInfo.textContent = 'å°†ä½¿ç”¨åŸå§‹å°ºå¯¸';
            } else {
                resizeInfo.textContent = `å°†è°ƒæ•´ä¸º ${targetWidth} x ${targetHeight} åƒç´ `;
            }
        }
        
        // é¢„è§ˆè°ƒæ•´åçš„å›¾ç‰‡
        previewResizeBtn.addEventListener('click', () => {
            if (!originalImageData) {
                showError('è¯·å…ˆä¸Šä¼ å›¾ç‰‡');
                return;
            }
            
            const targetWidth = parseInt(widthInput.value) || originalWidth;
            const targetHeight = parseInt(heightInput.value) || originalHeight;
            
            const img = new Image();
            img.onload = () => {
                const canvas = document.createElement('canvas');
                canvas.width = targetWidth;
                canvas.height = targetHeight;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, targetWidth, targetHeight);
                
                const resizedDataUrl = canvas.toDataURL('image/jpeg', 0.95);
                resizedImagePreview.src = resizedDataUrl;
                resizedInfoText.textContent = `è°ƒæ•´åå°ºå¯¸: ${targetWidth} x ${targetHeight} åƒç´ `;
                resizedPreviewContainer.classList.add('show');
            };
            img.src = originalImageData;
        });
        
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
        }
        
        // æäº¤åˆ†æ
        submitBtn.addEventListener('click', async () => {
            const prompt = document.getElementById('promptInput').value.trim();
            if (!prompt) {
                showError('è¯·è¾“å…¥æç¤ºè¯');
                return;
            }
            
            submitBtn.disabled = true;
            loading.classList.add('show');
            resultSection.classList.remove('show');
            hideError();
            
            try {
                if (currentMode === 'image') {
                    await analyzeImage(prompt);
                } else {
                    await analyzeVideo(prompt);
                }
            } catch (error) {
                showError('è¯·æ±‚å¤±è´¥: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                loading.classList.remove('show');
            }
        });
        
        async function analyzeImage(prompt) {
            if (!selectedImageFile) {
                showError('è¯·å…ˆé€‰æ‹©å›¾ç‰‡');
                return;
            }
            
            loadingText.textContent = 'æ­£åœ¨åˆ†æå›¾ç‰‡ï¼Œè¯·ç¨å€™...';
            
            const formData = new FormData();
            formData.append('image', selectedImageFile);
            formData.append('prompt', prompt);
            formData.append('model_id', modelSelect.value);
            
            // æ·»åŠ  media_resolution å‚æ•°ï¼ˆæ‰€æœ‰æ¨¡å‹éƒ½æ”¯æŒï¼‰
            formData.append('media_resolution', mediaResolutionSelect.value);
            
            const targetWidth = parseInt(widthInput.value);
            const targetHeight = parseInt(heightInput.value);
            
            if (!isNaN(targetWidth) && targetWidth > 0) {
                formData.append('target_width', targetWidth);
            }
            if (!isNaN(targetHeight) && targetHeight > 0) {
                formData.append('target_height', targetHeight);
            }
            
            const response = await fetch('/api/analyze', {
                method: 'POST',
                body: formData
            });
            
            const data = await response.json();
            
            if (data.error) {
                showError(data.error);
            } else {
                displayImageResult(data);
            }
        }
        
        async function analyzeVideo(prompt) {
            if (!selectedVideoFile) {
                showError('è¯·å…ˆé€‰æ‹©è§†é¢‘');
                return;
            }
            
            const videoMode = modeDirectRadio.checked ? 'direct' : 'frames';
            
            if (videoMode === 'direct') {
                loadingText.textContent = 'æ­£åœ¨å‘é€è§†é¢‘ç»™ Gemini åˆ†æï¼Œè¯·ç¨å€™...';
            } else {
                loadingText.textContent = 'æ­£åœ¨æå–è§†é¢‘å¸§å¹¶åˆ†æï¼Œè¯·ç¨å€™...';
            }
            
            const formData = new FormData();
            formData.append('video', selectedVideoFile);
            formData.append('prompt', prompt);
            formData.append('mode', videoMode);
            formData.append('model_id', modelSelect.value);
            
            // æ·»åŠ è§†é¢‘é«˜çº§è®¾ç½®å‚æ•°ï¼ˆç›´æ¥å‘é€è§†é¢‘æ¨¡å¼ï¼‰
            if (videoMode === 'direct') {
                formData.append('media_resolution', mediaResolutionSelect.value);
                
                // æ·»åŠ è§†é¢‘ FPS
                const videoFps = parseFloat(videoFpsInput.value);
                if (!isNaN(videoFps) && videoFps > 0 && videoFps <= 24) {
                    formData.append('video_fps', videoFps);
                }
                
                // æ·»åŠ èµ·å§‹æ—¶é—´
                const startOffset = startOffsetInput.value.trim();
                if (startOffset) {
                    // ç¡®ä¿æ ¼å¼æ­£ç¡®ï¼ˆæ·»åŠ  's' åç¼€å¦‚æœæ²¡æœ‰ï¼‰
                    const startValue = startOffset.endsWith('s') ? startOffset : startOffset + 's';
                    formData.append('start_offset', startValue);
                }
                
                // æ·»åŠ ç»“æŸæ—¶é—´
                const endOffset = endOffsetInput.value.trim();
                if (endOffset) {
                    const endValue = endOffset.endsWith('s') ? endOffset : endOffset + 's';
                    formData.append('end_offset', endValue);
                }
            }
            
            if (videoMode === 'frames') {
                formData.append('fps', fpsInput.value || '1');
                formData.append('max_frames', maxFramesInput.value || '30');
                
                // æ·»åŠ å¸§å°ºå¯¸å‚æ•°
                if (frameWidthInput.value) {
                    formData.append('frame_width', frameWidthInput.value);
                }
                if (frameHeightInput.value) {
                    formData.append('frame_height', frameHeightInput.value);
                }
            }
            
            const response = await fetch('/api/analyze_video', {
                method: 'POST',
                body: formData
            });
            
            const data = await response.json();
            
            if (data.error) {
                showError(data.error);
            } else {
                displayVideoResult(data);
            }
        }
        
        function displayTokenDetails(tokenDetails) {
            if (!tokenDetails) {
                document.getElementById('tokenDetailsSection').style.display = 'none';
                return;
            }
            
            // Input tokens è¯¦æƒ…
            const promptDetails = tokenDetails.prompt_tokens_details || {};
            document.getElementById('inputTextTokens').textContent = promptDetails.text_tokens || 0;
            document.getElementById('inputImageTokens').textContent = promptDetails.image_tokens || 0;
            document.getElementById('inputVideoTokens').textContent = promptDetails.video_tokens || 0;
            document.getElementById('inputAudioTokens').textContent = promptDetails.audio_tokens || 0;
            document.getElementById('inputCachedTokens').textContent = promptDetails.cached_tokens || 0;
            
            // Output tokens è¯¦æƒ…
            const candidatesDetails = tokenDetails.candidates_tokens_details || {};
            document.getElementById('outputTextTokens').textContent = candidatesDetails.text_tokens || 0;
            document.getElementById('outputImageTokens').textContent = candidatesDetails.image_tokens || 0;
            document.getElementById('outputVideoTokens').textContent = candidatesDetails.video_tokens || 0;
            document.getElementById('outputAudioTokens').textContent = candidatesDetails.audio_tokens || 0;
            
            // ç‰¹æ®Š tokens
            document.getElementById('thinkingTokens').textContent = candidatesDetails.thinking_tokens || 0;
            document.getElementById('toolUseTokens').textContent = candidatesDetails.tool_use_tokens || 0;
            document.getElementById('cachedContentTokens').textContent = tokenDetails.cached_content_token_count || 0;
            
            document.getElementById('tokenDetailsSection').style.display = 'block';
        }
        
        function displayImageResult(data) {
            document.getElementById('inputTokens').textContent = data.input_tokens || '-';
            document.getElementById('outputTokens').textContent = data.output_tokens || '-';
            document.getElementById('totalTokens').textContent = data.total_tokens || '-';
            document.getElementById('responseContent').textContent = data.response || 'æ— å“åº”å†…å®¹';
            
            // æ˜¾ç¤ºè¯¦ç»† token ä¿¡æ¯
            displayTokenDetails(data.token_details);
            
            // æ˜¾ç¤ºå›¾ç‰‡å°ºå¯¸ä¿¡æ¯
            document.getElementById('imageSizeInfo').style.display = 'block';
            document.getElementById('videoResultInfo').style.display = 'none';
            
            if (data.image_info) {
                document.getElementById('originalSizeText').textContent = `åŸå§‹å°ºå¯¸: ${data.image_info.original_size}`;
                document.getElementById('processedSizeText').textContent = `å¤„ç†åå°ºå¯¸: ${data.image_info.processed_size}`;
                document.getElementById('resizedText').textContent = `æ˜¯å¦è°ƒæ•´: ${data.image_info.resized ? 'æ˜¯' : 'å¦'}`;
            }
            
            // æ˜¾ç¤ºå¤„ç†åçš„å›¾ç‰‡
            if (data.processed_image_base64) {
                document.getElementById('processedImageResult').src = 'data:image/jpeg;base64,' + data.processed_image_base64;
                document.getElementById('processedImageSection').style.display = 'block';
            } else {
                document.getElementById('processedImageSection').style.display = 'none';
            }
            
            document.getElementById('framesPreviewSection').style.display = 'none';
            resultSection.classList.add('show');
        }
        
        function displayVideoResult(data) {
            document.getElementById('inputTokens').textContent = data.input_tokens || '-';
            document.getElementById('outputTokens').textContent = data.output_tokens || '-';
            document.getElementById('totalTokens').textContent = data.total_tokens || '-';
            document.getElementById('responseContent').textContent = data.response || 'æ— å“åº”å†…å®¹';
            
            // æ˜¾ç¤ºè¯¦ç»† token ä¿¡æ¯
            displayTokenDetails(data.token_details);
            
            // æ˜¾ç¤ºè§†é¢‘ä¿¡æ¯
            document.getElementById('imageSizeInfo').style.display = 'none';
            document.getElementById('videoResultInfo').style.display = 'block';
            
            if (data.video_info) {
                document.getElementById('videoDimensionsText').textContent = `è§†é¢‘å°ºå¯¸: ${data.video_info.width} x ${data.video_info.height}`;
                document.getElementById('videoDurationText').textContent = `è§†é¢‘æ—¶é•¿: ${data.video_info.duration} ç§’`;
                document.getElementById('videoOriginalFpsText').textContent = `åŸå§‹å¸§ç‡: ${data.video_info.original_fps} fps`;
                
                // æ ¹æ®æ¨¡å¼æ˜¾ç¤ºä¸åŒä¿¡æ¯
                if (data.video_info.mode === 'direct') {
                    let directInfo = `å¤„ç†æ¨¡å¼: ç›´æ¥å‘é€è§†é¢‘`;
                    if (data.video_info.video_fps) {
                        directInfo += ` | é‡‡æ ·å¸§ç‡: ${data.video_info.video_fps} fps`;
                    }
                    if (data.video_info.media_resolution) {
                        directInfo += ` | åˆ†è¾¨ç‡: ${data.video_info.media_resolution}`;
                    }
                    document.getElementById('videoExtractFpsText').textContent = directInfo;
                    
                    let clipInfo = '';
                    if (data.video_info.start_offset || data.video_info.end_offset) {
                        clipInfo = `æ—¶é—´è£å‰ª: ${data.video_info.start_offset || '0s'} - ${data.video_info.end_offset || 'ç»“æŸ'}`;
                    }
                    document.getElementById('framesExtractedText').textContent = clipInfo;
                } else {
                    let extractInfo = `æå–å¸§ç‡: ${data.video_info.extract_fps} fps`;
                    if (data.video_info.frame_size) {
                        extractInfo += ` | å¸§å°ºå¯¸: ${data.video_info.frame_size}`;
                    }
                    document.getElementById('videoExtractFpsText').textContent = extractInfo;
                    document.getElementById('framesExtractedText').textContent = `æå–å¸§æ•°: ${data.video_info.frames_extracted} å¸§`;
                }
            }
            
            // æ˜¾ç¤ºå¸§é¢„è§ˆ
            document.getElementById('processedImageSection').style.display = 'none';
            
            if (data.frames_preview && data.frames_preview.length > 0) {
                const framesPreview = document.getElementById('framesPreview');
                framesPreview.innerHTML = '';
                data.frames_preview.forEach((frameBase64, index) => {
                    const img = document.createElement('img');
                    img.src = 'data:image/jpeg;base64,' + frameBase64;
                    img.alt = `å¸§ ${index + 1}`;
                    img.title = `å¸§ ${index + 1}`;
                    framesPreview.appendChild(img);
                });
                document.getElementById('framesPreviewSection').style.display = 'block';
            } else {
                document.getElementById('framesPreviewSection').style.display = 'none';
            }
            
            resultSection.classList.add('show');
        }
        
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.add('show');
        }
        
        function hideError() {
            errorMessage.classList.remove('show');
        }
        
        // LangChain æŒ‰é’®
        const submitLangchainBtn = document.getElementById('submitLangchainBtn');
        
        // æ›´æ–° LangChain æŒ‰é’®çŠ¶æ€
        function updateLangchainButton() {
            if (currentMode === 'image') {
                submitLangchainBtn.disabled = !selectedImageFile;
                submitLangchainBtn.style.display = 'block';
            } else {
                submitLangchainBtn.style.display = 'none';
            }
        }
        
        // ä¿®æ”¹ updateSubmitButton å‡½æ•°
        const originalUpdateSubmitButton = updateSubmitButton;
        updateSubmitButton = function() {
            if (currentMode === 'image') {
                submitBtn.disabled = !selectedImageFile;
                submitLangchainBtn.disabled = !selectedImageFile;
                submitLangchainBtn.style.display = 'block';
            } else {
                submitBtn.disabled = !selectedVideoFile;
                submitLangchainBtn.style.display = 'none';
            }
        };
        
        // LangChain åˆ†æ
        submitLangchainBtn.addEventListener('click', async () => {
            const prompt = document.getElementById('promptInput').value.trim();
            if (!prompt) {
                showError('è¯·è¾“å…¥æç¤ºè¯');
                return;
            }
            
            if (!selectedImageFile) {
                showError('è¯·å…ˆé€‰æ‹©å›¾ç‰‡');
                return;
            }
            
            submitLangchainBtn.disabled = true;
            submitBtn.disabled = true;
            loading.classList.add('show');
            resultSection.classList.remove('show');
            hideError();
            
            loadingText.textContent = 'æ­£åœ¨ä½¿ç”¨ LangChain ChatVertexAI åˆ†æå›¾ç‰‡ (media_resolution=medium)...';
            
            try {
                const formData = new FormData();
                formData.append('image', selectedImageFile);
                formData.append('prompt', prompt);
                formData.append('model_id', modelSelect.value);
                formData.append('media_resolution', 'medium');  // å›ºå®šä½¿ç”¨ medium
                
                const response = await fetch('/api/analyze_langchain', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.error) {
                    showError(data.error);
                } else {
                    displayLangchainResult(data);
                }
            } catch (error) {
                showError('è¯·æ±‚å¤±è´¥: ' + error.message);
            } finally {
                submitLangchainBtn.disabled = false;
                submitBtn.disabled = false;
                loading.classList.remove('show');
            }
        });
        
        function displayLangchainResult(data) {
            document.getElementById('inputTokens').textContent = data.input_tokens || '-';
            document.getElementById('outputTokens').textContent = data.output_tokens || '-';
            document.getElementById('totalTokens').textContent = data.total_tokens || '-';
            document.getElementById('responseContent').textContent = data.response || 'æ— å“åº”å†…å®¹';
            
            // éšè—è¯¦ç»† token ä¿¡æ¯ï¼ˆLangChain è¿”å›æ ¼å¼ä¸åŒï¼‰
            document.getElementById('tokenDetailsSection').style.display = 'none';
            
            // æ˜¾ç¤º LangChain ä¿¡æ¯
            document.getElementById('imageSizeInfo').style.display = 'block';
            document.getElementById('videoResultInfo').style.display = 'none';
            
            document.getElementById('originalSizeText').textContent = `æ¡†æ¶: ${data.framework || 'langchain'}`;
            document.getElementById('processedSizeText').textContent = `Media Resolution: ${data.media_resolution || 'medium'}`;
            document.getElementById('resizedText').textContent = `Generation Config: ${JSON.stringify(data.generation_config || {})}`;
            
            document.getElementById('processedImageSection').style.display = 'none';
            document.getElementById('framesPreviewSection').style.display = 'none';
            resultSection.classList.add('show');
        }
        
        // åˆå§‹åŒ– LangChain æŒ‰é’®çŠ¶æ€
        updateSubmitButton();
    </script>
</body>
</html>
